参考：
http://gitbook.cn/gitchat/column/59f5daa149cd4330613605ba/topic/59f97f9c68673133615f74de

##RabbitMQ 介绍
AMQP 的主要特征是面向消息、队列、路由（包括点对点和发布/订阅）、可靠性、安全。


![](http://images.gitbook.cn/f8251e10-cdbb-11e7-8bfc-b7035590a94b)

- 左侧 P 代表生产者，也就是往 RabbitMQ 发消息的程序。
- 中间即是 RabbitMQ，其中包括了交换机和队列。
- 右侧 C 代表消费者，也就是往 RabbitMQ 拿消息的程序。

那么，其中比较重要的概念有 4 个，分别为：虚拟主机、交换机、队列和绑定。

- 虚拟主机：一个虚拟主机持有一组交换机、队列和绑定。为什么需要多个虚拟主机呢？很简单，RabbitMQ 当中，用户只能在虚拟主机的粒度进行权限控制。因此，如果需要禁止 A 组访问 B 组的交换机/队列/绑定，必须为 A 和 B 分别创建一个虚拟主机。每一个 RabbitMQ 服务器都有一个默认的虚拟主机“/”。
- 交换机：Exchange 用于转发消息，但是它不会做存储，如果没有 Queue bind 到 Exchange 的话，它会直接丢弃掉 Producer 发送过来的消息。

这里有一个比较重要的概念：路由键 。消息到交换机的时候，交换机会转发到对应的队列中，那么究竟转发到哪个队列，就要根据该路由键的情况。

- 绑定：也就是交换机需要和队列相绑定，这其中如上图所示，是多对多的关系。


###交换机（Exchange）

交换机的功能主要是接收消息并且转发到绑定的队列，交换机不存储消息，在启用 ack 模式后，交换机找不到队列，会返回错误。交换机有四种类型：Direct、Topic、Headers 和 Fanout 。

- Direct：该类型的行为是“先匹配，再投送”，即在绑定时设定一个 routing_key，消息的routing_key 匹配时，才会被交换器投送到绑定的队列中去。
- Topic：按规则转发消息（最灵活）。
- Headers：设置 header attribute 参数类型的交换机。
- Fanout：转发消息到所有绑定队列。


（1）Direct Exchange

Direct Exchange 是 RabbitMQ 默认的交换机模式，也是最简单的模式，根据 key 全文匹配去寻找队列。

（2）Topic Exchange

Topic Exchange 转发消息主要是根据通配符。在这种交换机下，队列和交换机的绑定会定义一种路由模式，那么，通配符就要在这种路由模式和路由键之间匹配后交换机才能转发消息。

（3）Headers Exchange

Headers 也是根据规则匹配，相较于 direct 和 topic 固定地使用 routing_key，Headers 则是一个自定义匹配规则的类型。在队列与交换器绑定时，会设定一组键值对规则，消息中也包括一组键值对(headers 属性)，当这些键值对有一对或全部匹配时，消息被投送到对应队列。

（4）Fanout Exchange

Fanout Exchange 消息广播的模式，不管路由键或者是路由模式，会把消息发给绑定给它的全部队列，如果配置了routing_key会被忽略。



#### 一对多发送
一个发送者、N 个接收者，经过测试接收端均匀接收到消息，也说明接收端自动进行了均衡负载，我们也可以利用这个特性做流量分发

#### 多对多发送
结论：发送端交替发送消息，接收端仍然会均匀接收到消息。
























